name:%20Anonymized%20import%20to%20melodIQ%0A%0Aon%3A%0A%20%20workflow_dispatch%3A%0A%0Ajobs%3A%0A%20%20import%3A%0A%20%20%20%20runs-on%3A%20ubuntu-latest%0A%20%20%20%20env%3A%0A%20%20%20%20%20%20TARGET_REPO%3A%20benjaminampereza/melodIQ%0A%20%20%20%20%20%20COMMIT_NAME:%20%22benjaminampereza%22%0A%20%20%20%20%20%20COMMIT_EMAIL:%20%22benjaminampereza@users.noreply.github.com%22%0A%20%20%20%20%20%20COMMIT_MSG:%20%22Initial%20import%20from%20Melody-Minds%20(authors%20removed)%22%0A%20%20%20%20steps:%0A%20%20%20%20%20%20-%20name:%20Checkout%20source%20repository%0A%20%20%20%20%20%20%20%20uses:%20actions/checkout@v4%0A%20%20%20%20%20%20%20%20with:%0A%20%20%20%20%20%20%20%20%20%20fetch-depth:%200%0A%0A%20%20%20%20%20%20-%20name:%20Prepare%20anonymized%20copy%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20set%20-euo%20pipefail%0A%20%20%20%20%20%20%20%20%20%20SRC_DIR=%22$GITHUB_WORKSPACE%22%0A%20%20%20%20%20%20%20%20%20%20IMPORT_DIR=%22$GITHUB_WORKSPACE/mm-import%22%0A%20%20%20%20%20%20%20%20%20%20rm%20-rf%20%22$IMPORT_DIR%22%0A%20%20%20%20%20%20%20%20%20%20mkdir%20-p%20%22$IMPORT_DIR%22%0A%20%20%20%20%20%20%20%20%20%20%23%20Copy%20working%20tree%20excluding%20.git%0A%20%20%20%20%20%20%20%20%20%20rsync%20-a%20--delete%20--exclude='.git'%20%22$SRC_DIR/%22%20%22$IMPORT_DIR/%22%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Remove%20AUTHORS/CONTRIBUTORS%20files%20(case-insensitive)%0A%20%20%20%20%20%20%20%20%20%20find%20%22$IMPORT_DIR%22%20-type%20f%20%5C(%20-iname%20'authors'%20-o%20-iname%20'authors.*'%20-o%20-iname%20'contributors'%20-o%20-iname%20'contributors.*'%20%5C)%20-print0%20%7C%20xargs%20-0%20-r%20rm%20-f%20%7C%7C%20true%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Scrub%20text%20files:%20remove%20header%20lines%20and%20personal%20info%20(emails,%20@mentions,%20Maintainer/Owner%20lines)%0A%20%20%20%20%20%20%20%20%20%20find%20%22$IMPORT_DIR%22%20-type%20f%20-print0%20%7C%20while%20IFS=%20read%20-r%20-d%20''%20f;%20do%0A%20%20%20%20%20%20%20%20%20%20%20%20mimetype=$(file%20--mime-type%20-b%20%22$f%22%20%7C%7C%20echo%20%22%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20echo%20%22$mimetype%22%20%7C%20grep%20-qiE%20'%5Etext/%7C/(json%7Cxml%7Cjavascript%7Cx-python%7Cx-shellscript)$';%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Remove%20author-like%20lines%20and%20strip%20email-like%20tokens%20and%20@mentions%20(aggressive)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20perl%20-0777%20-pe%20'%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20s/%5E%5B%20%5Ct%5D*(Author:%7CCreated%20by:%7CBy:%7CMaintainer:%7COwner:).*?$%5B%5Cr%5Cn%5D*//gim;%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20s/%5BA-Za-z0-9._%25+-%5D+@%5BA-Za-z0-9.-%5D+%5C.%5BA-Za-z%5D%7B2,%7D//g;%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20s/@%5BA-Za-z0-9._-%5D%7B1,39%7D//g;%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20'%20-i%20%22$f%22%20%7C%7C%20true%0A%20%20%20%20%20%20%20%20%20%20%20%20fi%0A%20%20%20%20%20%20%20%20%20%20done%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Update%20LICENSE/COPYRIGHT%20files%0A%20%20%20%20%20%20%20%20%20%20find%20%22$IMPORT_DIR%22%20-type%20f%20%5C(%20-iname%20'license*'%20-o%20-iname%20'copyright*'%20%5C)%20-print0%20%7C%20while%20IFS=%20read%20-r%20-d%20''%20lic;%20do%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20grep%20-Iq%20'%5Ecopyright'%20%22$lic%22;%20then%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20awk%20'BEGIN%7Bprinted=0%7D%20/%5E%5B%5B:space:%5D%5D*Copyright/i%20%7B%20if(!printed)%7Bprint%20%22Copyright%20(c)%202025%20benjaminampereza%22;%20printed=1%7D;%20next%20%7D%20%7Bprint%7D'%20%22$lic%22%20%3E%20%22$lic.tmp%22%20&&%20mv%20%22$lic.tmp%22%20%22$lic%22%0A%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7B%20echo%20%22Copyright%20(c)%202025%20benjaminampereza%22;%20cat%20%22$lic%22;%20%7D%20%3E%20%22$lic.tmp%22%20&&%20mv%20%22$lic.tmp%22%20%22$lic%22%0A%20%20%20%20%20%20%20%20%20%20%20%20fi%0A%20%20%20%20%20%20%20%20%20%20done%0A%0A%20%20%20%20%20%20%20%20%20%20%23%20Create%20import-report.txt%0A%20%20%20%20%20%20%20%20%20%20REPORT=%22$GITHUB_WORKSPACE/import-report.txt%22%0A%20%20%20%20%20%20%20%20%20%20echo%20%22Anonymized%20import%20report%22%20%3E%20%22$REPORT%22%0A%20%20%20%20%20%20%20%20%20%20echo%20%22%22%20%3E%3E%20%22$REPORT%22%0A%20%20%20%20%20%20%20%20%20%20echo%20%22Removed%20AUTHORS/CONTRIBUTORS%20(paths%20in%20source):%22%20%3E%3E%20%22$REPORT%22%0A%20%20%20%20%20%20%20%20%20%20find%20%22$SRC_DIR%22%20-type%20f%20%5C(%20-iname%20'authors'%20-o%20-iname%20'authors.*'%20-o%20-iname%20'contributors'%20-o%20-iname%20'contributors.*'%20%5C)%20-print%20%3E%3E%20%22$REPORT%22%20%7C%7C%20true%0A%20%20%20%20%20%20%20%20%20%20echo%20%22%22%20%3E%3E%20%22$REPORT%22%0A%20%20%20%20%20%20%20%20%20%20echo%20%22Prepared%20import%20directory:%20$IMPORT_DIR%22%20%3E%3E%20%22$REPORT%22%0A%20%20%20%20%20%20%20%20%20%20echo%20%22%22%20%3E%3E%20%22$REPORT%22%0A%20%20%20%20%20%20%20%20%20%20echo%20%22Please%20inspect%20mm-import%20and%20this%20report%20artifact%20before%20allowing%20the%20workflow%20to%20push%20in%20a%20production%20run.%22%20%3E%3E%20%22$REPORT%22%0A%0A%20%20%20%20%20%20-%20name:%20Create%20single-commit%20repository%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20set%20-euo%20pipefail%0A%20%20%20%20%20%20%20%20%20%20cd%20%22$GITHUB_WORKSPACE/mm-import%22%0A%20%20%20%20%20%20%20%20%20%20rm%20-rf%20.git%20%7C%7C%20true%0A%20%20%20%20%20%20%20%20%20%20git%20init%20-b%20main%0A%20%20%20%20%20%20%20%20%20%20git%20add%20--all%0A%20%20%20%20%20%20%20%20%20%20git%20config%20user.name%20%22$%7BCOMMIT_NAME%7D%22%0A%20%20%20%20%20%20%20%20%20%20git%20config%20user.email%20%22$%7BCOMMIT_EMAIL%7D%22%0A%20%20%20%20%20%20%20%20%20%20export%20GIT_COMMITTER_NAME=%22$%7BCOMMIT_NAME%7D%22%0A%20%20%20%20%20%20%20%20%20%20export%20GIT_COMMITTER_EMAIL=%22$%7BCOMMIT_EMAIL%7D%22%0A%20%20%20%20%20%20%20%20%20%20git%20commit%20--author=%22$%7BCOMMIT_NAME%7D%20%3C$%7BCOMMIT_EMAIL%7D%3E%22%20-m%20%22$%7BCOMMIT_MSG%7D%22%20%7C%7C%20true%0A%0A%20%20%20%20%20%20-%20name:%20Push%20to%20target%20repository%0A%20%20%20%20%20%20%20%20if:%20$%7B%7B%20secrets.TARGET_TOKEN%20!=%20''%20%7D%7D%0A%20%20%20%20%20%20%20%20env:%0A%20%20%20%20%20%20%20%20%20%20TARGET_TOKEN:%20$%7B%7B%20secrets.TARGET_TOKEN%20%7D%7D%0A%20%20%20%20%20%20%20%20run:%20%7C%0A%20%20%20%20%20%20%20%20%20%20set%20-euo%20pipefail%0A%20%20%20%20%20%20%20%20%20%20cd%20%22$GITHUB_WORKSPACE/mm-import%22%0A%20%20%20%20%20%20%20%20%20%20TARGET=%22https://x-access-token:$%7BTARGET_TOKEN%7D@github.com/$%7B%7B%20env.TARGET_REPO%20%7D%7D.git%22%0A%20%20%20%20%20%20%20%20%20%20git%20remote%20add%20origin%20%22$TARGET%22%0A%20%20%20%20%20%20%20%20%20%20git%20push%20-u%20origin%20main%20--force%0A%0A%20%20%20%20%20%20-%20name:%20Upload%20anonymized%20copy%20and%20report%0A%20%20%20%20%20%20%20%20uses:%20actions/upload-artifact@v4%0A%20%20%20%20%20%20%20%20with:%0A%20%20%20%20%20%20%20%20%20%20name:%20anonymized-import%0A%20%20%20%20%20%20%20%20%20%20path:%20%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20mm-import%0A%20%20%20%20%20%20%20%20%20%20%20%20import-report.txt
